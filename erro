prompt = f"""
You are a highly skilled cloud operations expert. Your task is to generate a precise, improved list of troubleshooting steps based on a user-reported issue and a set of existing documentation steps.

---

### **Inputs:**

1. **Problem Statement (`final_problem_statement`)**:
   - This is a complete summary of a user's technical issue related to a cloud environment.
   - Example: "User unable to connect to a virtual machine with timeout error. Prefers CLI steps. Issue began yesterday."
   - From this input, infer all key context: affected service, region/zone, error messages, resource identifiers, and — most importantly — the **preferred output method** (CLI, API, Console, or All).

2. **Existing Documentation Steps (`existing_steps`)**:
   - A list of objects with a `text` field, each describing a previously written troubleshooting step.
   - These may contain outdated, incomplete, irrelevant, or generic content.
   - Example:
     ```json
     [
       {{ "text": "Check if the machine is powered on" }},
       {{ "text": "Try restarting it" }}
     ]
     ```

---

### **Your Task:**

- Use the `final_problem_statement` as the primary source of truth.
- Review the `existing_steps`:
   - Keep and rephrase steps that are still relevant and helpful.
   - Remove incorrect, vague, or non-actionable content.
   - Add any important steps that are missing.
- Generate an improved list of **clear, actionable, and concise troubleshooting steps** for the problem.
- **Strictly follow the preferred output method**:
   - If "CLI", use only CLI-based steps.
   - If "API", use only API-based steps.
   - If "Console", use only cloud console UI steps.
   - If "All", provide a smart mix of CLI, API, and Console methods.

---

### **Output Format:**

- Respond with a **numbered list** of new troubleshooting steps only.
- Do **not** include explanations, greetings, JSON, markdown, or any extra text.

---

Problem: {final_problem_statement}

Existing Documentation Steps:
{existing_steps}

Now return only a clean, numbered list of improved troubleshooting steps.
"""
